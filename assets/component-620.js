"use strict";(globalThis.webpackChunkshopify_craft_and_berry=globalThis.webpackChunkshopify_craft_and_berry||[]).push([[620],{620:(e,r,i)=>{i.r(r),i.d(r,{iv_predictive_search:()=>d});var t=i(203),a=i(670);const s=["featured_image","image","title","price","price_formatted","currency","description","vendor","url","id","handle","author","published_at","product_type","type","tags"],o=["page","collection","product","article"],c={type:"product_type",img:"image"},n="iv-predictive-search",d=class{constructor(e){(0,t.r)(this,e),this.searchTermsChanged=(0,t.c)(this,"searchTermsChanged")}searchlabel;labelposition="top";action;method="get";placeholder;minchars=3;debounce=300;resultslimit=5;showspinner;noresultstext="No results found";requestedfields="title";requestedresources="product,article,page,collection";showallbuttontext;querybuttontext;clearbutton;expandable=!1;tablayout;gridlayout;searchTerm;searchReturnData=[];noResults=!1;searchTermsChanged;debounceTimer;abortController;cache=new Map;normalizeAction(e){return(e&&e.trim()?e:"/search").replace(/\/+$/,"")}parseRequestedFields(){const e=(this.requestedfields||"").split(",").map(e=>e.trim()).filter(Boolean).map(e=>c[e]||e),r=Array.from(new Set(e.filter(e=>s.includes(e))));return r.includes("resource")||r.push("resource"),r}normalizeImageUrl(e){const r="string"==typeof e?e:e?.url||e?.src||void 0;if(r)return r.startsWith("//")?`https:${r}`:r}get hasRenderableResults(){return!!this.searchTerm&&this.searchTerm.length>=this.minchars&&this.searchReturnData.length>0}get resultsListId(){return`${n}-results`}get tabLabels(){return Array.from(new Set(this.searchReturnData.map(e=>e.resource)))}get useGridLayout(){return!!this.gridlayout}get gridTemplateAreas(){return this.gridlayout?this.gridlayout.split(",").map(e=>`"${e.trim()}"`).join(" "):""}get gridAreaNames(){return Array.from(new Set(this.searchReturnData.map(e=>e.resource)))}confirmRequestedResources(){const e=this.requestedresources.split(",").map(e=>e.trim()).filter(Boolean).filter(e=>o.includes(e));return 0===e.length?(console.warn('No valid resources specified, defaulting to "product,article,page,collection"'),"product,article,page,collection"):e.join(",")}async fetchPredictive(e){const r=e.trim();if(!r||r.length<this.minchars)return this.searchReturnData=[],void(this.noResults=!1);if(this.cache.has(r))return this.searchReturnData=this.cache.get(r),void(this.noResults=0===(this.searchReturnData?.length??0));this.abortController&&this.abortController.abort(),this.abortController=new AbortController;const i=this.normalizeAction(this.action),a=new URLSearchParams;a.set("q",r),a.set("resources[type]",this.confirmRequestedResources()),a.set("resources[limit]",String(this.resultslimit));const s=`${i}/suggest.json?${a.toString()}`;t.d.loading=!0;try{const e=await fetch(s,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest","Cache-Control":"no-store"},cache:"no-store",signal:this.abortController.signal});if(!e.ok)throw new Error(`${e.status}: ${e.statusText}`);const i=await e.json(),t=this.normalizeShopifyResponse(i);this.searchReturnData=t,this.noResults=0===t.length,this.cache.set(r,t)}catch(e){"AbortError"!==e?.name&&(console.error("Predictive search error:",e),this.searchReturnData=[],this.noResults=!1)}finally{t.d.loading=!1,this.searchTermsChanged.emit(r)}}normalizeShopifyResponse(e){const r=[],i=e?.resources?.results??e?.resources??{},t=(e,i)=>{const t="products"===(a=i)?"product":"collections"===a?"collection":"articles"===a?"article":"pages"===a?"page":a;var a;e.forEach(e=>r.push(this.pickFieldsByResource(e,t)))};return["products","collections","articles","pages"].forEach(e=>{const r=i?.[e]||[];Array.isArray(r)&&t(r,e)}),r}pickFieldsByResource(e,r){const i=e?.url||e?.online_store_url||e?.path||"",s=e?.handle||"",o=e?.id??e?.legacyResourceId??e?.legacy_resource_id??void 0,c=e?.title||e?.name||e?.page_title||"",n=e?.body||e?.body_html||e?.excerpt||e?.description||"",d=e?.vendor||e?.author||"",l=e?.author||"",p=e?.published_at||e?.created_at||"",h=e?.product_type||e?.type||"",u=this.normalizeImageUrl(e?.featured_image?.url??e?.featured_image)||this.normalizeImageUrl(e?.image?.url??e?.image?.src??e?.image)||this.normalizeImageUrl(Array.isArray(e?.images)?e.images[0]:void 0),v="object"==typeof e?.featured_image&&(e?.featured_image?.alt||e?.featured_image?.altText)||"object"==typeof e?.image&&(e?.image?.alt||e?.image?.altText)||Array.isArray(e?.images)&&"object"==typeof e.images[0]&&(e.images[0]?.alt||e.images[0]?.altText)||c||"",m=e?.price_min?.toString?.()||e?.price?.toString?.()||(Array.isArray(e?.variants)?e.variants[0]?.price?.toString?.():void 0),g=m?(0,a.f)(Number(m),t.d.currencyCode):void 0,b={resource:r,url:i,id:o,handle:s,title:c,image:u,featured_image:u,image_alt:v,price:m,description:n,vendor:d,author:l,published_at:p,product_type:h,tags:e?.tags||[],currency:(0,a.a)(t.d.currencyCode),price_formatted:g},f=this.parseRequestedFields().map(e=>"type"===e?"product_type":e).filter(Boolean);f.includes("resource")||f.push("resource"),f.includes("url")||f.push("url");const y={};for(const e of f)null!=b[e]&&""!==b[e]&&(y[e]=b[e]);return b.image_alt&&(y.image_alt=b.image_alt),b.price&&(y.price_formatted=b.price_formatted??(0,a.f)(Number(b.price),t.d.currencyCode),b.currency&&(y.currency=b.currency)),y}handleSearchInput=e=>{const r=e.target.value||"";this.searchTerm=r,this.querybuttontext||(clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.fetchPredictive(r)},this.debounce))};handleSearchSubmit=e=>{e.preventDefault(),this.fetchPredictive(this.searchTerm)};renderResults(e){return!this.searchTerm||this.searchTerm.length<this.minchars?null:(0,t.h)(t.h.Fragment,null,(0,t.h)("div",{class:"results-group-title"},(0,t.h)("span",{class:"tertiary-title"},e)),(0,t.h)("ul",{id:this.resultsListId,class:`${n}-prediction-list`,role:"listbox"},this.searchReturnData.map((r,i)=>r.resource===e&&r.url&&(0,t.h)("li",{key:i,class:`${n}-prediction-item`,role:"option"},(0,t.h)("a",{class:`${n}-prediction-link`,href:r.url},this.parseRequestedFields().filter(e=>"resource"!==e&&"url"!==e).filter(e=>"image"===e||"featured_image"===e).map((e,i)=>{const a=r[e];return null==a||""===a?null:(0,t.h)("img",{key:i,class:"prediction-image",src:a,alt:r.image_alt||r.title||""})}),(0,t.h)("div",{class:`${n}-prediction-details`},this.parseRequestedFields().filter(e=>"resource"!==e&&"url"!==e).filter(e=>"image"!==e&&"featured_image"!==e).map((e,i)=>{const s="type"===e?"product_type":e,o=r[s];if(null==o||""===o)return null;if("price"===s){const e=r.price_formatted??(0,a.f)(Number(o),t.d.currencyCode);return(0,t.h)("span",{key:i,class:`prediction-part prediction-${s}-span`},e)}return(0,t.h)("span",{key:i,class:`prediction-part prediction-${s}-span`},o)})))))))}render(){const e=this.hasRenderableResults,r=`${this.normalizeAction(this.action)}?q=${encodeURIComponent(this.searchTerm||"")}`,i=!!this.searchTerm&&this.searchTerm.length>=this.minchars;return(0,t.h)("form",{key:"84ad2582e766e453ec111fce1a29792fe73797ff",class:`${n}${this.expandable?" expandable":""}`,action:this.action,method:this.method,role:"search",onSubmit:this.handleSearchSubmit},(0,t.h)("div",{key:"b2cb7b52146a2e575942ec242093440b0d0b674b",class:`${n}-wrapper ${this.labelposition?`label-${this.labelposition}`:""}`},this.searchlabel&&(0,t.h)("label",{key:"aaa98028bfc0aa352f73f79c2afcd16fa61f613e",class:`${n}-label`,htmlFor:"Search"},this.searchlabel),(0,t.h)("input",{key:"039633898ba1a8305516cd554b5ae55468edc0e1",id:"Search",class:`${n}-input`,type:"search",name:"q",value:this.searchTerm,onInput:this.handleSearchInput,role:"combobox","aria-expanded":e?"true":"false","aria-owns":this.resultsListId,"aria-controls":this.resultsListId,"aria-haspopup":"listbox","aria-autocomplete":"list",placeholder:this.placeholder}),this.querybuttontext&&(0,t.h)("iv-button",{key:"88a8f713325cb5b10bee5e8024838235abf8b774",classmodifier:`${n}-submit`,type:"submit"},(0,t.h)("span",{key:"9ba9a9d6f3a6f0fa3d0a63ec6f062ae034263b5f",class:"inner-button",innerHTML:this.querybuttontext})),this.clearbutton&&(0,t.h)("iv-button",{key:"67d77a7856a1a353f17f3e3e5975e3d9f9c27ea7",classmodifier:`${n}-clear`,type:"button",onClick:()=>{this.searchTerm="",this.searchReturnData=[],this.noResults=!1,this.searchTermsChanged.emit("")}},(0,t.h)("span",{key:"7fd552f8051c959cd796a3386210e10860ecf1f3",class:"inner-button",innerHTML:this.clearbutton}))),this.showspinner&&(0,t.h)("iv-spinner",{key:"42b70e35c4ea4c463067a1959f8dee8812d0e882",show:this.showspinner&&t.d.loading}),(0,t.h)("div",{key:"c7fd0a8fb525ba567bfc5feec21b1696ea99a8a8",class:`${n}-results`},i&&(this.searchReturnData.length>0?this.useGridLayout?(0,t.h)("iv-layout",{gridTemplateAreas:this.gridTemplateAreas,classModifier:n},this.gridAreaNames.map(e=>(0,t.h)("div",{slot:e},this.renderResults(e)))):(0,t.h)("iv-tabs",{classModifier:n,labels:this.tabLabels,tabLayout:this.tablayout},this.tabLabels.map((e,r)=>(0,t.h)("div",{slot:`tab-content-${r}`},this.renderResults(e)))):this.noResults&&!t.d.loading?(0,t.h)("div",{class:`${n}-no-results`},(0,t.h)("p",null,this.noresultstext)):null)),this.showallbuttontext&&e&&(0,t.h)("div",{key:"78e5804168cff84be8292c9c72d7dc25fe160c65",class:`${n}-see-all`},(0,t.h)("a",{key:"5ee5a5ea59a24422fded868b875213c2e3d24796",class:"btn btn-link",href:r},this.showallbuttontext)))}};d.style=".iv-predictive-search{box-sizing:border-box;width:var(--iv-predictive-width, 100%);max-width:var(--iv-predictive-max-width, 100%);margin:var(--iv-predictive-margin, 0);padding:var(--iv-predictive-padding, 0);position:relative;background:var(--iv-predictive-background, transparent);border:var(--iv-predictive-border, none);border-radius:var(--iv-predictive-border-radius, 0);box-shadow:var(--iv-predictive-box-shadow, none);font-family:var(--iv-predictive-font-family, inherit);font-size:var(--iv-predictive-font-size, 1rem);color:var(--iv-predictive-text-color, inherit);transition:var(--iv-predictive-transition, box-shadow 0.2s ease, border-color 0.2s ease)}.iv-predictive-search-wrapper{box-sizing:border-box;padding:var(--iv-predictive-wrapper-padding, 0);display:var(--iv-predictive-wrapper-display, block);gap:var(--iv-predictive-wrapper-gap, 0.5rem)}.iv-predictive-search-wrapper.label-top .iv-predictive-search-label{display:block}.iv-predictive-search-wrapper.label-inline{display:flex;align-items:center;gap:var(--iv-predictive-inline-gap, 0.5rem)}.iv-predictive-search-label{margin:var(--iv-predictive-label-margin, 0 0 0.25rem 0);font-size:var(--iv-predictive-label-font-size, 1rem);font-weight:var(--iv-predictive-label-font-weight, 500);color:var(--iv-predictive-label-color, inherit);line-height:var(--iv-predictive-label-line-height, 1.2)}.iv-predictive-search-input{box-sizing:border-box;width:100%;background:var(--iv-predictive-input-background, transparent);color:var(--iv-predictive-input-color, inherit);border:var(--iv-predictive-input-border, 1px solid currentColor);border-radius:var(--iv-predictive-input-border-radius, 0);padding:var(--iv-predictive-input-padding, 0.5rem 0.75rem);font-size:var(--iv-predictive-input-font-size, inherit);line-height:var(--iv-predictive-input-line-height, 1.2);outline:none;transition:var(--iv-predictive-input-transition, border-color 0.2s ease, box-shadow 0.2s ease)}.iv-predictive-search-input:focus{border:var(--iv-predictive-input-focus-border, var(--iv-predictive-input-border, 1px solid currentColor));box-shadow:var(--iv-predictive-input-focus-shadow, 0 0 0 2px rgba(0, 0, 0, 0.15))}.iv-predictive-search-results{position:var(--iv-predictive-results-position, absolute);top:var(--iv-predictive-results-top, 100%);left:var(--iv-predictive-results-left, 0);right:var(--iv-predictive-results-right, 0);z-index:var(--iv-predictive-results-z-index, 10);margin:var(--iv-predictive-results-margin, 0.5rem 0 0 0);padding:var(--iv-predictive-results-padding, 0.5rem);background:var(--iv-predictive-results-background, var(--iv-predictive-background, transparent));border:var(--iv-predictive-results-border, var(--iv-predictive-border, none));border-radius:var(--iv-predictive-results-border-radius, var(--iv-predictive-border-radius, 0));box-shadow:var(--iv-predictive-results-box-shadow, var(--iv-predictive-box-shadow, none));box-sizing:border-box}.iv-predictive-search-prediction-list{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:var(--iv-predictive-list-gap, 0.5rem)}.iv-predictive-search-prediction-item{background:var(--iv-predictive-item-background, transparent);border-radius:var(--iv-predictive-item-border-radius, 0);transition:var(--iv-predictive-item-transition, background 0.2s ease, color 0.2s ease)}.iv-predictive-search-prediction-item:hover{background:var(--iv-predictive-item-hover-background, var(--iv-predictive-item-background, transparent))}.iv-predictive-search-prediction-link{display:flex;align-items:center;text-decoration:none;color:var(--iv-predictive-link-color, inherit);padding:var(--iv-predictive-link-padding, 0.25rem 0.5rem);border-radius:var(--iv-predictive-link-border-radius, 0);gap:var(--iv-predictive-link-gap, 0.5rem);background:var(--iv-predictive-link-background, transparent);transition:var(--iv-predictive-link-transition, background 0.2s ease, color 0.2s ease)}.iv-predictive-search-prediction-link:hover{color:var(--iv-predictive-link-hover-color, var(--iv-predictive-link-color, inherit));background:var(--iv-predictive-link-hover-background, var(--iv-predictive-link-background, transparent))}.iv-predictive-search-prediction-link .prediction-image{width:var(--iv-predictive-image-width, 48px);height:var(--iv-predictive-image-height, 48px);object-fit:var(--iv-predictive-image-object-fit, cover);border-radius:var(--iv-predictive-image-border-radius, 0);background:var(--iv-predictive-image-background, transparent);border:var(--iv-predictive-image-border, none);flex:0 0 auto}.iv-predictive-search-prediction-link .prediction-part{font-size:var(--iv-predictive-part-font-size, 1rem);color:var(--iv-predictive-part-color, inherit);margin-right:var(--iv-predictive-part-margin-right, 0)}.iv-predictive-search-no-results{padding:var(--iv-predictive-no-results-padding, 0.5rem);font-size:var(--iv-predictive-no-results-font-size, 0.875rem);color:var(--iv-predictive-no-results-color, inherit);text-align:var(--iv-predictive-no-results-text-align, center);opacity:var(--iv-predictive-no-results-opacity, 0.8)}.iv-predictive-search-see-all{margin-top:var(--iv-predictive-see-all-margin-top, 0.75rem);text-align:var(--iv-predictive-see-all-text-align, right)}@media (prefers-reduced-motion: reduce){.iv-predictive-search,.iv-predictive-search-input,.iv-predictive-search-prediction-item,.iv-predictive-search-prediction-link{transition:none}}"},670:(e,r,i)=>{function t(e){return e.replace(/&quot;/g,'"')}function a(e){return e?e.split(",").map(e=>e.trim()):null}function s(e,r="GBP",i="en-GB"){return new Intl.NumberFormat(i,{style:"currency",currency:r}).format(e/100)}function o(e="GBP",r="en-GB"){return(0).toLocaleString(r,{style:"currency",currency:e,minimumFractionDigits:0,maximumFractionDigits:0}).replace(/\d/g,"").trim()}function c(e){return Number(e.split("/").pop())}i.d(r,{a:()=>o,d:()=>t,f:()=>s,g:()=>c,r:()=>a})}}]);